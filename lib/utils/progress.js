"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _progress = _interopRequireDefault(require("progress"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var _default = function _default(total, label, options) {
  if (!options) {
    options = {};
  }

  if (!options.format) {
    options.format = "=> ".concat(label ? "".concat(label, " ") : '', "[:bar] :current/:total :percent :rate/s :etas ");
  }

  var stream = options.stream || process.stderr;

  if (stream.isTTY && !options.forceNonTTY) {
    options.total = total;
    return new _progress.default(options.format, options);
  }

  var curr = 0;
  var percent = 0;
  var start = new Date();
  return {
    tick: function tick() {
      curr += 1;
      var ratio = Math.min(Math.max(curr / total, 0), 1);
      var value = Math.floor(ratio * 100);

      if (value >= percent + 5) {
        percent = value;
        var elapsed = new Date() - start;
        var eta = percent === 100 ? 0 : elapsed * (total / curr - 1);
        var rate = curr / (elapsed / 1000);
        stream.write("".concat(options.format.replace('[:bar] ', '').replace('[:bar]', '').replace(':current', curr).replace(':total', total).replace(':elapsed', Number.isNaN(elapsed) ? '0.0' : (elapsed / 1000).toFixed(1)).replace(':eta', Number.isNaN(eta) || !Number.isFinite(eta) ? '0.0' : (eta / 1000).toFixed(1)).replace(':percent', "".concat(percent.toFixed(0), "%")).replace(':rate', Math.round(rate)), "\n"));
      }
    }
  };
};

exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy91dGlscy9wcm9ncmVzcy5qcyJdLCJuYW1lcyI6WyJ0b3RhbCIsImxhYmVsIiwib3B0aW9ucyIsImZvcm1hdCIsInN0cmVhbSIsInByb2Nlc3MiLCJzdGRlcnIiLCJpc1RUWSIsImZvcmNlTm9uVFRZIiwiUHJvZ3Jlc3MiLCJjdXJyIiwicGVyY2VudCIsInN0YXJ0IiwiRGF0ZSIsInRpY2siLCJyYXRpbyIsIk1hdGgiLCJtaW4iLCJtYXgiLCJ2YWx1ZSIsImZsb29yIiwiZWxhcHNlZCIsImV0YSIsInJhdGUiLCJ3cml0ZSIsInJlcGxhY2UiLCJOdW1iZXIiLCJpc05hTiIsInRvRml4ZWQiLCJpc0Zpbml0ZSIsInJvdW5kIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7Ozs7ZUFFZSxrQkFBQ0EsS0FBRCxFQUFRQyxLQUFSLEVBQWVDLE9BQWYsRUFBMkI7QUFDeEMsTUFBSSxDQUFDQSxPQUFMLEVBQWM7QUFDWkEsSUFBQUEsT0FBTyxHQUFHLEVBQVY7QUFDRDs7QUFDRCxNQUFJLENBQUNBLE9BQU8sQ0FBQ0MsTUFBYixFQUFxQjtBQUNuQkQsSUFBQUEsT0FBTyxDQUFDQyxNQUFSLGdCQUNFRixLQUFLLGFBQU1BLEtBQU4sU0FBaUIsRUFEeEI7QUFHRDs7QUFDRCxNQUFNRyxNQUFNLEdBQUdGLE9BQU8sQ0FBQ0UsTUFBUixJQUFrQkMsT0FBTyxDQUFDQyxNQUF6Qzs7QUFDQSxNQUFJRixNQUFNLENBQUNHLEtBQVAsSUFBZ0IsQ0FBQ0wsT0FBTyxDQUFDTSxXQUE3QixFQUEwQztBQUN4Q04sSUFBQUEsT0FBTyxDQUFDRixLQUFSLEdBQWdCQSxLQUFoQjtBQUNBLFdBQU8sSUFBSVMsaUJBQUosQ0FBYVAsT0FBTyxDQUFDQyxNQUFyQixFQUE2QkQsT0FBN0IsQ0FBUDtBQUNEOztBQUNELE1BQUlRLElBQUksR0FBRyxDQUFYO0FBQ0EsTUFBSUMsT0FBTyxHQUFHLENBQWQ7QUFDQSxNQUFNQyxLQUFLLEdBQUcsSUFBSUMsSUFBSixFQUFkO0FBQ0EsU0FBTztBQUNMQyxJQUFBQSxJQUFJLEVBQUUsZ0JBQU07QUFDVkosTUFBQUEsSUFBSSxJQUFJLENBQVI7QUFDQSxVQUFNSyxLQUFLLEdBQUdDLElBQUksQ0FBQ0MsR0FBTCxDQUFTRCxJQUFJLENBQUNFLEdBQUwsQ0FBU1IsSUFBSSxHQUFHVixLQUFoQixFQUF1QixDQUF2QixDQUFULEVBQW9DLENBQXBDLENBQWQ7QUFDQSxVQUFNbUIsS0FBSyxHQUFHSCxJQUFJLENBQUNJLEtBQUwsQ0FBV0wsS0FBSyxHQUFHLEdBQW5CLENBQWQ7O0FBRUEsVUFBSUksS0FBSyxJQUFJUixPQUFPLEdBQUcsQ0FBdkIsRUFBMEI7QUFDeEJBLFFBQUFBLE9BQU8sR0FBR1EsS0FBVjtBQUNBLFlBQU1FLE9BQU8sR0FBRyxJQUFJUixJQUFKLEtBQWFELEtBQTdCO0FBQ0EsWUFBTVUsR0FBRyxHQUFHWCxPQUFPLEtBQUssR0FBWixHQUFrQixDQUFsQixHQUFzQlUsT0FBTyxJQUFJckIsS0FBSyxHQUFHVSxJQUFSLEdBQWUsQ0FBbkIsQ0FBekM7QUFDQSxZQUFNYSxJQUFJLEdBQUdiLElBQUksSUFBSVcsT0FBTyxHQUFHLElBQWQsQ0FBakI7QUFDQWpCLFFBQUFBLE1BQU0sQ0FBQ29CLEtBQVAsV0FDS3RCLE9BQU8sQ0FBQ0MsTUFBUixDQUNBc0IsT0FEQSxDQUNRLFNBRFIsRUFDbUIsRUFEbkIsRUFFQUEsT0FGQSxDQUVRLFFBRlIsRUFFa0IsRUFGbEIsRUFHQUEsT0FIQSxDQUdRLFVBSFIsRUFHb0JmLElBSHBCLEVBSUFlLE9BSkEsQ0FJUSxRQUpSLEVBSWtCekIsS0FKbEIsRUFLQXlCLE9BTEEsQ0FNQyxVQU5ELEVBT0NDLE1BQU0sQ0FBQ0MsS0FBUCxDQUFhTixPQUFiLElBQXdCLEtBQXhCLEdBQWdDLENBQUNBLE9BQU8sR0FBRyxJQUFYLEVBQWlCTyxPQUFqQixDQUF5QixDQUF6QixDQVBqQyxFQVNBSCxPQVRBLENBVUMsTUFWRCxFQVdDQyxNQUFNLENBQUNDLEtBQVAsQ0FBYUwsR0FBYixLQUFxQixDQUFDSSxNQUFNLENBQUNHLFFBQVAsQ0FBZ0JQLEdBQWhCLENBQXRCLEdBQ0ksS0FESixHQUVJLENBQUNBLEdBQUcsR0FBRyxJQUFQLEVBQWFNLE9BQWIsQ0FBcUIsQ0FBckIsQ0FiTCxFQWVBSCxPQWZBLENBZVEsVUFmUixZQWV1QmQsT0FBTyxDQUFDaUIsT0FBUixDQUFnQixDQUFoQixDQWZ2QixRQWdCQUgsT0FoQkEsQ0FnQlEsT0FoQlIsRUFnQmlCVCxJQUFJLENBQUNjLEtBQUwsQ0FBV1AsSUFBWCxDQWhCakIsQ0FETDtBQW1CRDtBQUNGO0FBL0JJLEdBQVA7QUFpQ0QsQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBQcm9ncmVzcyBmcm9tICdwcm9ncmVzcydcblxuZXhwb3J0IGRlZmF1bHQgKHRvdGFsLCBsYWJlbCwgb3B0aW9ucykgPT4ge1xuICBpZiAoIW9wdGlvbnMpIHtcbiAgICBvcHRpb25zID0ge31cbiAgfVxuICBpZiAoIW9wdGlvbnMuZm9ybWF0KSB7XG4gICAgb3B0aW9ucy5mb3JtYXQgPSBgPT4gJHtcbiAgICAgIGxhYmVsID8gYCR7bGFiZWx9IGAgOiAnJ1xuICAgIH1bOmJhcl0gOmN1cnJlbnQvOnRvdGFsIDpwZXJjZW50IDpyYXRlL3MgOmV0YXMgYFxuICB9XG4gIGNvbnN0IHN0cmVhbSA9IG9wdGlvbnMuc3RyZWFtIHx8IHByb2Nlc3Muc3RkZXJyXG4gIGlmIChzdHJlYW0uaXNUVFkgJiYgIW9wdGlvbnMuZm9yY2VOb25UVFkpIHtcbiAgICBvcHRpb25zLnRvdGFsID0gdG90YWxcbiAgICByZXR1cm4gbmV3IFByb2dyZXNzKG9wdGlvbnMuZm9ybWF0LCBvcHRpb25zKVxuICB9XG4gIGxldCBjdXJyID0gMFxuICBsZXQgcGVyY2VudCA9IDBcbiAgY29uc3Qgc3RhcnQgPSBuZXcgRGF0ZSgpXG4gIHJldHVybiB7XG4gICAgdGljazogKCkgPT4ge1xuICAgICAgY3VyciArPSAxXG4gICAgICBjb25zdCByYXRpbyA9IE1hdGgubWluKE1hdGgubWF4KGN1cnIgLyB0b3RhbCwgMCksIDEpXG4gICAgICBjb25zdCB2YWx1ZSA9IE1hdGguZmxvb3IocmF0aW8gKiAxMDApXG5cbiAgICAgIGlmICh2YWx1ZSA+PSBwZXJjZW50ICsgNSkge1xuICAgICAgICBwZXJjZW50ID0gdmFsdWVcbiAgICAgICAgY29uc3QgZWxhcHNlZCA9IG5ldyBEYXRlKCkgLSBzdGFydFxuICAgICAgICBjb25zdCBldGEgPSBwZXJjZW50ID09PSAxMDAgPyAwIDogZWxhcHNlZCAqICh0b3RhbCAvIGN1cnIgLSAxKVxuICAgICAgICBjb25zdCByYXRlID0gY3VyciAvIChlbGFwc2VkIC8gMTAwMClcbiAgICAgICAgc3RyZWFtLndyaXRlKFxuICAgICAgICAgIGAke29wdGlvbnMuZm9ybWF0XG4gICAgICAgICAgICAucmVwbGFjZSgnWzpiYXJdICcsICcnKVxuICAgICAgICAgICAgLnJlcGxhY2UoJ1s6YmFyXScsICcnKVxuICAgICAgICAgICAgLnJlcGxhY2UoJzpjdXJyZW50JywgY3VycilcbiAgICAgICAgICAgIC5yZXBsYWNlKCc6dG90YWwnLCB0b3RhbClcbiAgICAgICAgICAgIC5yZXBsYWNlKFxuICAgICAgICAgICAgICAnOmVsYXBzZWQnLFxuICAgICAgICAgICAgICBOdW1iZXIuaXNOYU4oZWxhcHNlZCkgPyAnMC4wJyA6IChlbGFwc2VkIC8gMTAwMCkudG9GaXhlZCgxKVxuICAgICAgICAgICAgKVxuICAgICAgICAgICAgLnJlcGxhY2UoXG4gICAgICAgICAgICAgICc6ZXRhJyxcbiAgICAgICAgICAgICAgTnVtYmVyLmlzTmFOKGV0YSkgfHwgIU51bWJlci5pc0Zpbml0ZShldGEpXG4gICAgICAgICAgICAgICAgPyAnMC4wJ1xuICAgICAgICAgICAgICAgIDogKGV0YSAvIDEwMDApLnRvRml4ZWQoMSlcbiAgICAgICAgICAgIClcbiAgICAgICAgICAgIC5yZXBsYWNlKCc6cGVyY2VudCcsIGAke3BlcmNlbnQudG9GaXhlZCgwKX0lYClcbiAgICAgICAgICAgIC5yZXBsYWNlKCc6cmF0ZScsIE1hdGgucm91bmQocmF0ZSkpfVxcbmBcbiAgICAgICAgKVxuICAgICAgfVxuICAgIH0sXG4gIH1cbn1cbiJdfQ==